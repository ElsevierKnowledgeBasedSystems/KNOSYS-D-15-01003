<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project default="package" name="xjaf2x-server.jar">
	
	<property environment="env" />
	<fail if="${env.JBOSS_HOME}" message="Environment variable JBOSS_HOME not defined" />
	<property name="dest.file" value="../xjaf2x-server.jar" />
		
	<target name="clean">
		<delete file="${dest.file}" />
	</target>

	<target name="package" depends="clean">
		<jar destfile="${dest.file}">
			<manifest>
				<attribute name="Class-Path" value="WEB-INF/lib/jason-1.3.9.jar" />
				<attribute name="Dependencies" value="org.infinispan export" />
			</manifest>
			<fileset dir="build/classes" />
			<fileset dir="." includes="maps/**" />
			<zipgroupfileset dir="war/WEB-INF/lib" includes="*.jar" />
		</jar>
	</target>
	
	<target name="undeploy">
		<exec executable="${env.JBOSS_HOME}/bin/jboss-cli.bat">
			<arg value="--connect" />
			<arg value="--controller=ultrabook" />
			<arg value='"undeploy xjaf2x-server --server-groups=xjaf2x-group"' />
		</exec>
	</target>
	
	<target name="deploy" depends="package, undeploy">
		<exec executable="${env.JBOSS_HOME}/bin/jboss-cli.bat">
			<arg value="--connect" />
			<arg value="--controller=ultrabook" />
			<arg value='"deploy ${dest.file} --name=xjaf2x-server --server-groups=xjaf2x-group"' />
		</exec>
	</target>
</project>
